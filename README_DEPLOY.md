# 🚀 智能填表助手 - 部署指南

## 📋 项目简介

这是一个基于 FastAPI 的智能填表系统，支持：
- 📄 Word 文档自动填写（.docx）
- 👥 用户登录/认证系统
- 🎛️ 管理员后台管理
- 💬 用户反馈收集
- 🔑 临时账号管理（带有效期）
- 🤖 AI 智能填表（需配置 API Key）

## 🎯 推荐部署平台：Render.com

### 为什么选择 Render？

- ✅ **完全免费**：每月 750 小时运行时间（≈全月运行）
- ✅ **存储空间**：免费提供 1GB 磁盘空间
- ✅ **带宽充足**：每月 100GB 带宽
- ✅ **零配置**：自动检测 Python 项目并部署
- ✅ **自动扩容**：根据流量自动调整资源
- ✅ **一键部署**：GitHub 仓库直接部署

### 成本分析

- **100 用户/月**：完全在免费额度内
- **零成本运营**：直到用户量大幅增长才需付费

---

## 🛠️ Render 部署步骤

### 步骤 1：准备代码

1. 确保代码已推送到 GitHub 仓库
2. 项目根目录包含以下文件：
   - `server_with_auth.py` - 主服务器文件
   - `models.py` - 数据库模型
   - `auth.py` - 认证模块
   - `requirements.txt` - Python 依赖
   - `core.py` 或 `core_improved.py` - 核心填表模块
   - `static/` - 前端静态文件目录

### 步骤 2：注册 Render 账号

1. 访问 [render.com](https://render.com)
2. 点击 "Get Started for Free"
3. 使用 GitHub 账号登录

### 步骤 3：创建 Web Service

1. 点击 Dashboard 上的 **"New"** 按钮
2. 选择 **"Web Service"**
3. 选择 **"Build and deploy from a Git repository"**
4. 找到并选择您的 GitHub 仓库
5. 点击 **"Connect"**

### 步骤 4：配置部署参数

在配置页面填写以下信息：

| 参数 | 值 |
|------|-----|
| **Name** | `smart-form-filler`（或您喜欢的名称） |
| **Region** | 选择离您最近的区域（推荐 Singapore 或 Tokyo） |
| **Branch** | `main`（或您的默认分支） |
| **Root Directory** | 留空（如果项目在根目录） |
| **Runtime** | `Python 3` |
| **Build Command** | `pip install -r requirements.txt` |
| **Start Command** | `uvicorn server_with_auth:app_instance --host 0.0.0.0 --port $PORT` |

### 步骤 5：配置环境变量

在 **"Environment"** 部分添加：

```env
ARK_API_KEY=5410d463-1115-4320-9279-a5441ce30694
MODEL_ENDPOINT=doubao-seed-1-6-251015
PORT=10000
```

**⚠️ 重要**：
- `ARK_API_KEY`：您的豆包模型 API Key（已配置默认密钥，可根据需要更换）
- `MODEL_ENDPOINT`：模型名称，默认为 doubao-seed-1-6-251015
- `PORT`：Render 会自动分配，无需修改

### 步骤 6：配置磁盘存储（可选但推荐）

1. 滚动到 **"Disk"** 部分
2. 点击 **"Add Disk"**
3. 配置：
   - **Name**: `uploads`
   - **Size**: `1GB`
   - **Mount Path**: `/app/uploads`

### 步骤 7：开始部署

1. 点击 **"Create Web Service"**
2. 等待构建完成（约 3-5 分钟）
3. 部署完成后，您会得到一个 URL，类似：`https://smart-form-filler.onrender.com`

### 步骤 8：初始化管理员账号

1. 访问：`https://your-app.onrender.com/login`
2. 使用默认管理员账号登录：
   - **用户名**: `admin`
   - **密码**: `admin123`
3. 登录后请立即修改密码

---

## 🔑 临时账号系统使用说明

### 系统特点

- ❌ **关闭用户注册**：用户无法自行注册账号
- ✅ **管理员生成**：管理员生成随机账号密码
- ⏰ **自动过期**：默认 7 天有效期，可自定义
- 🎛️ **后台管理**：查看、删除临时账号

### 管理员操作步骤

1. **登录后台**
   - 访问：`https://your-app.onrender.com/admin`
   - 使用管理员账号登录

2. **生成临时账号**
   - 在"临时账号管理"卡片中
   - 输入有效期（天数，1-365 天）
   - 点击"🎁 生成新账号"
   - 系统会弹出显示账号密码信息
   - **请复制保存账号信息！**

3. **管理临时账号**
   - 查看所有临时账号列表
   - 显示剩余天数和状态
   - 可删除不需要的账号
   - 可筛选显示已过期账号

4. **分享给用户**
   - 将生成的账号密码发送给用户
   - 用户访问：`https://your-app.onrender.com/login`
   - 使用账号密码登录使用系统

### 临时账号特点

- **用户名格式**：`temp_xxxx`（如：temp_a3b9）
- **密码格式**：10位随机字符，包含大小写字母、数字和符号
- **有效期**：默认7天，可在生成时自定义
- **自动过期**：过期后无法登录
- **仅一次登录**：用户可以重复登录，直到过期

---

## 📊 后台管理功能

访问 `https://your-app.onrender.com/admin`（需管理员权限）：

### 1. 统计概览
- 总用户数
- 临时账号数
- 已过期账号数
- 总操作数
- 成功/失败操作数
- 待处理反馈数

### 2. 用户列表
- 查看所有注册用户
- 显示是否为管理员
- 显示注册时间

### 3. 临时账号管理
- 生成新的临时账号
- 查看账号列表和有效期
- 删除不需要的账号

### 4. 用户反馈
- 查看所有用户反馈
- 筛选反馈类型和状态
- 查看反馈详情和截图
- 回复用户反馈

### 5. 操作日志
- 查看所有用户操作记录
- 筛选用户名和操作类型
- 查看详细的操作数据

---

## 🐳 Docker 部署（可选）

如果您有自己的服务器，也可以使用 Docker 部署：

### 使用 Docker Compose

```bash
# 克隆项目
git clone <your-repo-url>
cd smart-form-filler

# 复制环境变量文件
cp .env.example .env
# .env 文件已预配置豆包API，可直接使用

# 启动服务
docker-compose up -d
```

访问 `http://localhost:8000`

### 仅使用 Docker

```bash
# 构建镜像
docker build -t smart-form-filler .

# 运行容器
docker run -d \
  -p 8000:8000 \
  -e ARK_API_KEY=5410d463-1115-4320-9279-a5441ce30694 \
  -e MODEL_ENDPOINT=doubao-seed-1-6-251015 \
  smart-form-filler
```

---

## 🔧 其他免费平台部署

### Railway.app

1. 访问 [railway.app](https://railway.app)
2. 连接 GitHub 仓库
3. 平台会自动检测并部署
4. 配置环境变量（ARK_API_KEY 等）

### Fly.io

1. 安装 Fly CLI
2. 运行：`fly launch`
3. 按照提示配置
4. 部署：`fly deploy`

---

## ⚙️ 配置说明

### 环境变量

| 变量名 | 必需 | 默认值 | 说明 |
|--------|------|--------|------|
| `ARK_API_KEY` | ✅ | 5410d463-1115-4320-9279-a5441ce30694 | 豆包模型 API Key |
| `MODEL_ENDPOINT` | ❌ | doubao-seed-1-6-251015 | 模型名称 |
| `PORT` | ❌ | 8000 | 服务器端口 |

### 数据库

- **开发环境**：SQLite（文件存储）
- **生产环境**：可升级为 PostgreSQL（Render 提供免费选项）

---

## 📈 性能优化建议

### 1. 监控资源使用
- Render Dashboard 可查看 CPU、内存、带宽使用情况
- 建议定期清理过期账号和日志

### 2. 文件存储优化
- 上传的 docx 和图片会占用存储空间
- 定期清理 `uploads/screenshots` 目录

### 3. 数据库优化
- SQLite 适合中小型应用（< 1万用户）
- 用户量增长后可迁移到 PostgreSQL

---

## 🛡️ 安全建议

### 1. 修改默认密码
- 部署后立即修改管理员密码
- 使用强密码（包含大小写、数字、符号）

### 2. 保护 API Key
- 不要将 ARK_API_KEY 提交到 GitHub
- 使用 Render 的环境变量管理

### 3. 定期备份
- 下载数据库文件作为备份
- 定期导出用户反馈数据

---

## ❓ 常见问题

### Q: 部署后填表功能不工作？
A: 检查 `ARK_API_KEY` 环境变量是否配置正确（已预配置豆包API密钥）

### Q: 如何修改管理员密码？
A: 登录后台后暂无直接修改入口，可通过数据库修改或联系开发者

### Q: 临时账号过期了怎么办？
A: 管理员可在后台删除过期账号，或生成新的临时账号

### Q: 可以自定义有效期吗？
A: 可以，生成临时账号时可设置 1-365 天的有效期

### Q: 支持多少并发用户？
A: Render 免费版支持少量并发，100 用户分散使用没问题

### Q: 如何备份数据？
A: SQLite 数据库文件位于 `/data/app.db`，可定期下载备份

---

## 📞 技术支持

如果遇到问题，可以：

1. 查看 Render 日志
2. 检查浏览器控制台错误
3. 查看系统操作日志（后台管理 → 操作日志）
4. 提交用户反馈（反馈页面）

---

## 📝 更新日志

### v2.0.0
- ✅ 添加临时账号系统
- ✅ 关闭用户注册功能
- ✅ 添加账号有效期管理
- ✅ 优化后台管理界面
- ✅ 支持 Render 免费部署

### v1.0.0
- ✅ 基础填表功能
- ✅ 用户认证系统
- ✅ 管理员后台
- ✅ 用户反馈系统

---

## 🎉 部署完成！

恭喜！您已成功部署智能填表助手系统。

**下一步**：
1. 测试登录和填表功能
2. 生成几个临时账号
3. 分享给用户体验
4. 收集反馈持续优化

祝您使用愉快！🚀
